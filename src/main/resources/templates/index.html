<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500&display=swap" rel="stylesheet">


    <link rel="stylesheet" href="../static/fonts/icomoon/style.css" th:href="@{/fonts/icomoon/style.css}">

    <link rel="stylesheet" href="../static/css/classic.css" th:href="@{/css/classic.css}">
    <link rel="stylesheet" href="../static/css/classic.date.css" th:href="@{/css/classic.date.css}">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}">

    <!-- Style -->
    <link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.23.0/axios.min.js"></script>
    <title>Title</title>
</head>
<body style="overflow-x: hidden!important;" class="text-center d-flex flex-column justify-content-center">

<nav style="background: lightgray" class="text-center d-flex justify-content-center row">
<!--    <h1>Hisobot</h1>-->
<!--    <h1 class="text-center">Hisobot-->
<!--    </h1>-->
    <div class="col">
        <span>

            <a href="/logout" style="float: right!important;" class="btn-info btn">Chiqish</a>
        </span>
<!--        <h1 class="">Hisobot</h1>-->
    </div>
</nav>

<!--<main class="container-fluid text-center d-flex justify-content-center">-->

<!--    <section class="form-group">-->
<!--        <input type="date" class="form-control">-->
<!--    </section>-->


<!--    <section>-->
<!--        <table id="table"></table>-->
<div>

</div>
        <div class="content">
            <div class="container text-left">
                <div class="row justify-content-center">
                    <div class="col-lg-3">
                        <h5 id="ism" class="text-center mb-2">Ism</h5>
<!--                        <h2 class="text-center" id="select_year">{Davr}</h2>-->
                        <h2 id="select_year" class="mb-5 text-center">Hisobot davrini tanlang</h2>
                        <div class="text-center">
                            <div class="form-group">
                                <input onchange="viewSelectYear(this.value)" type="text" class="form-control" id="pick-date" placeholder="Pick A Date">
<!--                                <div id="task_select_div" class="form-group text-center">-->
<!--                                    <label for="task_select">Vazifa turini tanlang</label>-->
<!--                                    <select class="form-control" id="task_select">-->
<!--                                        <option value="5">1</option>-->
<!--                                        <option>2</option>-->
<!--                                        <option>3</option>-->
<!--                                        <option>4</option>-->
<!--                                    </select>-->
<!--                                </div>-->
                            </div>

                            <div id="task_select_div" style="display: none" class="form-group text-center">
                                <label for="task_select">Vazifa turini tanlang</label>
                                <select onchange="taskChangeHandler()" class="form-control" id="task_select">
                                    <option value="5">1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                </select>
                                <button class="btn-success btn" data-toggle="modal" data-target="#exampleModal">Qo'shish</button>
                            </div>

                        </div>

                    </div>

                    <div id="task_content" style="background: #e5e5e5; display: none" class="col-12 text-center mt-2">
<!--                        <table  class="table table-striped table-bordered mt-3 mb-3 shadow" style="background: #ececec">-->
<!--                            <thead>-->
<!--&lt;!&ndash;                            <h3>asdad</h3>&ndash;&gt;-->
<!--                            <tr>-->
<!--                                <th class="" style="background: lightgray" colspan="2">-->
<!--                                    <h3 class="">Task</h3>-->
<!--                                    <button class="btn-info btn">Tahrirlash</button>-->
<!--                                    <button class="btn-danger btn">O'chirish</button>-->
<!--                                </th>-->
<!--                            </tr>-->
<!--                            <tr>-->
<!--                                <th>Data</th>-->
<!--                                <th>Izoh</th>-->
<!--                            </tr>-->
<!--                            </thead>-->
<!--                            <tbody>-->
<!--                            <tr class="">-->
<!--                                <td style="color: white; font-weight: bold; background: #4a7e53">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam aliquid asperiores autem beatae distinctio, dolor excepturi fugiat libero optio quam soluta, vel voluptatibus. Dolor nobis non nostrum odio quod veniam.</td>-->
<!--                                <td>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus culpa dignissimos dolores earum enim itaque natus, neque unde. Aliquam atque beatae cumque dicta dolorem harum hic magnam praesentium repellendus suscipit!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Alias architecto atque blanditiis cumque dolor eos esse exercitationem fugiat ipsam maiores nobis provident quaerat, quasi quo, suscipit, veritatis vero voluptate voluptatem!</td>-->
<!--                            </tr>-->
<!--                            <tr class="">-->
<!--                                <td style="color: white; font-weight: bold; background: #4a7e53">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam aliquid asperiores autem beatae distinctio, dolor excepturi fugiat libero optio quam soluta, vel voluptatibus. Dolor nobis non nostrum odio quod veniam.</td>-->
<!--                                <td>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus culpa dignissimos dolores earum enim itaque natus, neque unde. Aliquam atque beatae cumque dicta dolorem harum hic magnam praesentium repellendus suscipit!Lorem ipsum dolor sit amet, consectetur adipisicing elit. Alias architecto atque blanditiis cumque dolor eos esse exercitationem fugiat ipsam maiores nobis provident quaerat, quasi quo, suscipit, veritatis vero voluptate voluptatem!</td>-->
<!--                            </tr>-->
<!--                            </tbody>-->
<!--                        </table>-->



                    </div>
                </div>
            </div>
        </div>

<section>

</section>
<!--    </section>-->
<!--</main>-->

<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="edit_task_title">New message</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit_modal">
                    <!--                    <div class="form-group">-->
                    <!--                        <label for="recipient-name" class="col-form-label">Recipient:</label>-->
                    <!--                        <input type="text" class="form-control" id="recipient-name">-->
                    <!--                    </div>-->
                    <!--                    <div class="form-group">-->
                    <!--                        <label for="message-text" class="col-form-label">Message:</label>-->
                    <!--                        <textarea class="form-control" id="message-text"></textarea>-->
                    <!--                    </div>-->
                </form>
            </div>
            <!--            <div class="modal-footer">-->
            <!--                <button type="button" class="btn btn-secondary" data-dismiss="modal">Yopish</button>-->
            <!--                <button id="submit_button" type="button" class="btn btn-primary">Qo'shish</button>-->
            <!--            </div>-->
        </div>
    </div>
</div>


<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="task_title">New message</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="save_modal">
<!--                    <div class="form-group">-->
<!--                        <label for="recipient-name" class="col-form-label">Recipient:</label>-->
<!--                        <input type="text" class="form-control" id="recipient-name">-->
<!--                    </div>-->
<!--                    <div class="form-group">-->
<!--                        <label for="message-text" class="col-form-label">Message:</label>-->
<!--                        <textarea class="form-control" id="message-text"></textarea>-->
<!--                    </div>-->
                </form>
            </div>
<!--            <div class="modal-footer">-->
<!--                <button type="button" class="btn btn-secondary" data-dismiss="modal">Yopish</button>-->
<!--                <button id="submit_button" type="button" class="btn btn-primary">Qo'shish</button>-->
<!--            </div>-->
        </div>
    </div>
</div>


</body>
<script src="../static/js/jquery-3.3.1.min.js" th:src="@{/js/jquery-3.3.1.min.js}"></script>
<script src="../static/js/popper.min.js" th:src="@{/js/popper.min.js}"></script>
<script src="../static/js/bootstrap.min.js" th:src="@{/js/bootstrap.min.js}"></script>
<script src="../static/js/picker.js" th:src="@{/js/picker.js}"></script>
<script src="../static/js/picker.date.js" th:src="@{/js/picker.date.js}"></script>

<script src="../static/js/main.js" th:src="@{/js/main.js}"></script>
<script src="../static/js/vanillajs-table.js" th:src="@{/js/vanillajs-table.js}"></script>
<script>
    function viewSelectYear(e) {
        console.log(e)
        if (e===""){
            document.getElementById("select_year").innerText="Hisobot davrini tanlang";
            document.getElementById("task_select_div").style.display="none"
            document.getElementById("task_content").style.display="none"

        }
        else {
            drawTasks()
            getAllDoneTasks(e)
            taskSelect();
            document.getElementById("select_year").innerText=e;
            document.getElementById("task_content").style.display="block"

        }
    }
    
    function getAllDoneTasks(date) {
        axios.get("/api/df/all/user/"+date)
        .then(function (response) {
            console.log("ALLLLLLFIELDS")
            console.log(response)
            console.log(response.data)
        })
        .catch(function (error) {
            console.log(error)
        })
    }

    function taskSelect() {
        axios.get("/api/task/all")
            .then(function (response) {
                // console.log(response)
                // console.log(response.data)
                let data=response.data;
                let out="<option value=''>Tanlang</option>";
                data.forEach(d=>{
                    out+="<option value='"+d.id+"'>"+d.name+"</option>"
                })
                document.getElementById("task_select_div").style.display="block"
                document.getElementById("task_select").innerHTML=out;
            })
            .catch(function (error) {
                console.log(error)
            })
    }

    function taskChangeHandler() {
        let value=document.getElementById("task_select").value;
        // let text=document.getElementById("task_select").innerText;
        console.log(value)
        // if (value!==""){
            taskFormGenerator(value)
        // }
    }

    function taskFormGenerator(taskId) {
        let out="";
        console.log("TaskId = "+taskId)
        if (taskId!=""){
            axios.get("/api/field/all/"+taskId)
                .then(function (response) {
                    console.log(response)
                    console.log(response.data)
                    let data=response.data;
                    for (let i = 0; i <data.length ; i++) {
                        document.getElementById("task_title").innerText=data[i].task.name
                        out+="<div class=\"form-group\">\n" +
                            "                        <label for='"+data[i].id+"' class=\"col-form-label\">"+data[i].name+"</label>" +
                            inputBuilder(data[i])+
                            " </div>";
                    }
                    if (data.length>0){
                        out+="   <div class=\"modal-footer\">\n" +
                            "                <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Yopish</button>\n" +
                            "                <button id=\"submit_button\" type=\"submit\" class=\"btn btn-primary\">Qo'shish</button>\n" +
                            "            </div>"
                    }else {
                        out+="   <div class=\"modal-footer\">\n" +
                            "                <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Yopish</button>\n" +
                            // "                <button id=\"submit_button\" type=\"submit\" data-dismiss=\"modal\" class=\"btn btn-primary\">Qo'shish</button>\n" +
                            "            </div>"
                    }


                    document.getElementById("save_modal").innerHTML=out;

                })
                .catch(function (error) {
                    console.log(error)
                })
        }
        else {
            document.getElementById("save_modal").innerHTML="";

        }

    }







    function inputBuilder(object) {
        switch (object.type) {
            case "TEXT": return "<input name='"+object.id+"' placeholder='"+object.placeholder+"' type='text' class=\"form-control\" id='"+object.id+"'>"
            case "NUMBER": return "<input name='"+object.id+"' placeholder='"+object.placeholder+"' type='number' class=\"form-control\" id='"+object.id+"'>"
            case "PHONE": return "<input name='"+object.id+"' placeholder='"+object.placeholder+"' type='tel' class=\"form-control\" id='"+object.id+"'>"
            case "TEXTAREA": return "<textarea name='"+object.id+"' placeholder='"+object.placeholder+"' type='number' class=\"form-control\" id='"+object.id+"'></textarea>"
            case "DATE": return "<input name='"+object.id+"' placeholder='"+object.placeholder+"' type='datetime-local' class=\"form-control\" id='"+object.id+"'>"
            default: return "";
        }
    }

    // function submitControl(event) {
    //     event.preventDefault();
    //     console.log(event)
    // }
    $( "#save_modal" ).submit(function( event ) {
        let data=$(this).serializeArray();
        event.preventDefault();
        axios.post("/api/df/add/special/"+document.getElementById("pick-date").value,data)
        .then(function (response) {
            console.log(response)
            drawTasks()
            // $('#save_modal').modal().hide();
            // $("#save_modal .close").click()
        })
        .catch(function (error) {
            console.log(error)
            // $('#modal').modal().hide();
        })
        $('#exampleModal').modal('toggle'); //or  $('#IDModal').modal('hide');
        // return false;
        // console.log( $( this ).serializeArray() );
    });

    $( "#edit_modal" ).submit(function( event ) {
        let data=$(this).serializeArray();
        event.preventDefault();
        axios.post("/api/df/edit/special/"+document.getElementById("pick-date").value,data)
            .then(function (response) {
                console.log(response)
                drawTasks()
                // $('#save_modal').modal().hide();
                // $("#save_modal .close").click()
            })
            .catch(function (error) {
                console.log(error)
                // $('#modal').modal().hide();
            })
        $('#editModal').modal('toggle'); //or  $('#IDModal').modal('hide');
        // return false;
        // console.log( $( this ).serializeArray() );
    });


    axios.get("/api/me")
    .then(function (response) {
        document.getElementById("ism").innerText=response.data;
    })

    function drawTasks() {
        let date=document.getElementById("pick-date").value;

        axios.get("/api/document/check/"+date)
        .then(function (response) {
            if (response.data=="true"){
                axios.get("/api/df/all/user/spec/"+date)
                    .then(function (response) {

                        if (response.status==200){

                            let data=response.data;
                            let out="";
                            console.log(data)
                            if (data.length>0&&data[0].length>0){

                                for (let i = 0; i <data.length ; i++) {
                                    let content="";
                                    out+="<table  class=\"table table-striped table-bordered mt-3 mb-3 shadow\" style=\"background: #ececec\">\n" +
                                        "                            <thead>\n" +
                                        "<!--                            <h3>asdad</h3>-->\n" +
                                        "                            <tr>\n" +
                                        "                                <th class=\"\" style=\"background: lightgray\" colspan=\"2\">\n" +
                                        "                                    <h3 class=\"\">"+(data[i][0]&&data[i][0].field?data[i][0].field.task.name:"")+"</h3>\n" +
                                        // "                                    <button data-toggle=\"modal\" data-target=\"#editModal\" value='"+data[i][0].taskNumber+"' onclick='editFormGenerator(this.value)' class=\"btn-info btn\">Tahrirlash</button>\n" +
                                        // "                                    <button value='"+(data[i][0]&&data[i][0].field?data[i][0].taskNumber:"")+"' onclick='deleteTask(this.value)' class=\"btn-danger btn\">O'chirish</button>\n" +
                                        "                                </th>\n" +
                                        "                            </tr>\n" +
                                        "                            <tr>\n" +
                                        "                                <th>Data</th>\n" +
                                        "                                <th>Izoh</th>\n" +
                                        "                            </tr>\n" +
                                        "                            </thead>\n" +
                                        "                            <tbody>"
                                    for (let j = 0; j <data[i].length ; j++) {
                                        content+="<tr class=\"\">\n" +
                                            "                                <td class='w-50' style=\"color: white; font-weight: bold; background: #4a7e53\">"+data[i][j].field.name+"</td>\n" +
                                            "                                <td class='w-50'>"+data[i][j].data+"</td>\n" +
                                            "                            </tr>"
                                    }
                                    out+=content;
                                    out+="</tbody>\n" +
                                        "                        </table>"

                                }
                            }
                            document.getElementById("task_content").innerHTML=out;
                        }
                    })
                    .catch(function (error) {
                        console.log(error)
                    })
            }
            else {
                axios.get("/api/df/all/user/spec/"+date)
                    .then(function (response) {

                        if (response.status==200){

                            let data=response.data;
                            let out="";
                            console.log(data)
                            if (data.length>0&&data[0].length>0){

                                for (let i = 0; i <data.length ; i++) {
                                    let content="";
                                    out+="<table  class=\"table table-striped table-bordered mt-3 mb-3 shadow\" style=\"background: #ececec\">\n" +
                                        "                            <thead>\n" +
                                        "<!--                            <h3>asdad</h3>-->\n" +
                                        "                            <tr>\n" +
                                        "                                <th class=\"\" style=\"background: lightgray\" colspan=\"2\">\n" +
                                        "                                    <h3 class=\"\">"+(data[i][0]&&data[i][0].field?data[i][0].field.task.name:"")+"</h3>\n" +
                                        "                                    <button data-toggle=\"modal\" data-target=\"#editModal\" value='"+data[i][0].taskNumber+"' onclick='editFormGenerator(this.value)' class=\"btn-info btn\">Tahrirlash</button>\n" +
                                        "                                    <button value='"+(data[i][0]&&data[i][0].field?data[i][0].taskNumber:"")+"' onclick='deleteTask(this.value)' class=\"btn-danger btn\">O'chirish</button>\n" +
                                        "                                </th>\n" +
                                        "                            </tr>\n" +
                                        "                            <tr>\n" +
                                        "                                <th>Data</th>\n" +
                                        "                                <th>Izoh</th>\n" +
                                        "                            </tr>\n" +
                                        "                            </thead>\n" +
                                        "                            <tbody>"
                                    for (let j = 0; j <data[i].length ; j++) {
                                        content+="<tr class=\"\">\n" +
                                            "                                <td class='w-50' style=\"color: white; font-weight: bold; background: #4a7e53\">"+data[i][j].field.name+"</td>\n" +
                                            "                                <td class='w-50'>"+data[i][j].data+"</td>\n" +
                                            "                            </tr>"
                                    }
                                    out+=content;
                                    out+="</tbody>\n" +
                                        "                        </table>"

                                }
                            }
                            document.getElementById("task_content").innerHTML=out;
                        }


                    })
                    .catch(function (error) {
                        console.log(error)
                    })
            }
        })


    }



    function deleteTask(taskNumber) {
        axios.delete("/api/df/delete/"+taskNumber)
        .then(function (res) {
            console.log(res.data)
            drawTasks()
            // setTimeout(, 1000);

        })
        .catch(function (error) {
            console.log(error)
        })
    }



    //EDIT

    function edit(taskNumber) {
        axios.get("/api/df/one/spec/"+taskNumber)
        .then(function (response) {
            console.log(response.data)
        })
        .catch(function (error) {
            console.log(error)
        })
    }

    function editFormGenerator(taskNumber) {
        let out="";
        console.log("taskNumber = "+taskNumber)
        if (taskNumber!=""){
            axios.get("/api/df/one/spec/"+taskNumber)
                .then(function (response) {
                    console.log(response)
                    console.log(response.data)
                    let data=response.data;




                    for (let i = 0; i <data.length ; i++) {
                        document.getElementById("edit_task_title").innerText=data[0].field.task.name
                        out+="<div class=\"form-group\">\n" +
                            "                        <label for='edit_"+data[i].id+"' class=\"col-form-label\">"+data[i].field.name+"</label>" +
                            editInputBuilder(data[i],data[i].data)+
                            " </div>";
                    }
                    if (data.length>0){
                        out+="   <div class=\"modal-footer\">\n" +
                            "                <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Yopish</button>\n" +
                            "                <button id=\"submit_button\" type=\"submit\" class=\"btn btn-primary\">Saqlash</button>\n" +
                            "            </div>"
                    }else {
                        out+="   <div class=\"modal-footer\">\n" +
                            "                <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Yopish</button>\n" +
                            // "                <button id=\"submit_button\" type=\"submit\" data-dismiss=\"modal\" class=\"btn btn-primary\">Qo'shish</button>\n" +
                            "            </div>"
                    }


                    document.getElementById("edit_modal").innerHTML=out;

                })
                .catch(function (error) {
                    console.log(error)
                })
        }
        else {
            document.getElementById("edit_modal").innerHTML="";

        }

    }


    function editInputBuilder(object,value) {
        switch (object.field.type) {
            case "TEXT": return "<input value='"+value+"' name='"+object.id+"' placeholder='"+object.field.placeholder+"' type='text' class=\"form-control\" id='edit_"+object.id+"'>"
            case "NUMBER": return "<input value='"+value+"' name='"+object.id+"' placeholder='"+object.field.placeholder+"' type='number' class=\"form-control\" id='edit_"+object.id+"'>"
            case "PHONE": return "<input value='"+value+"' name='"+object.id+"' placeholder='"+object.field.placeholder+"' type='tel' class=\"form-control\" id='edit_"+object.id+"'>"
            case "TEXTAREA": return "<textarea value='"+value+"' name='"+object.id+"' placeholder='"+object.field.placeholder+"' type='number' class=\"form-control\" id='edit_"+object.id+"'>"+value+"</textarea>"
            case "DATE": return "<input value='"+value+"' name='"+object.id+"' placeholder='"+object.field.placeholder+"' type='datetime-local' class=\"form-control\" id='edit_"+object.id+"'>"
            default: return "";
        }
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.1/js/bootstrap.min.js" integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</html>